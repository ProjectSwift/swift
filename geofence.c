/* Project Swift - High altitude balloon flight software                 */
/*=======================================================================*/
/* Copyright 2010-2012 Nigel Smart <nigel@projectswift.co.uk>            */
/*                                                                       */
/* This program is free software: you can redistribute it and/or modify  */
/* it under the terms of the GNU General Public License as published by  */
/* the Free Software Foundation, either version 3 of the License, or     */
/* (at your option) any later version.                                   */
/*                                                                       */
/* This program is distributed in the hope that it will be useful,       */
/* but WITHOUT ANY WARRANTY; without even the implied warranty of        */
/* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the          */
/* GNU General Public License for more details.                          */
/*                                                                       */
/* You should have received a copy of the GNU General Public License     */
/* along with this program. If not, see <http://www.gnu.org/licenses/>.  */
#include <stdio.h>

float geofence[50*2] =

{ 
48.99240438916019,-3.610360370654134,
48.81389031863564,-2.261025770913471,
49.1901282525471,-1.325297817228903,
49.63512178841542,-1.005050872123723,
50.10379987764846,1.127999359221193,
50.77227583244341,1.626061977986558,
51.31898099696213,2.515236772641401,
52.07655977830789,3.511937361391556,
53.04540239433694,4.297015297526864,
53.90016343230752,4.990969427818814,
54.6830552445366,4.472766824766669,
55.12302924034837,3.460101288258272,
55.43360342487385,2.990490695861038,
55.84187415567083,2.648729041756971,
56.68060143707408,2.448889658878936,
57.59317542416268,1.672393634830836,
58.4164868437969,1.175924046866346,
58.96411506458556,0.4293681655062649,
60.1679345280046,-0.5502415293166254,
60.21068033378364,-2.29118889910277,
59.80686755528706,-3.179735009595071,
59.47417534318514,-5.243213953063538,
59.07677501954371,-11.29272636354675,
58.6042329547382,-12.56824379042234,
57.35606798592618,-12.3463450585634,
56.84849652915574,-11.06796651299962,
56.79608197785362,-9.402971499042556,
56.59551764376715,-8.403646016897726,
56.24889690898385,-7.462113653096664,
55.88885749518966,-6.85084471881917,
55.46238310778117,-6.21933005701142,
55.4506766043798,-7.556049214332897,
55.22836249917683,-8.643422893971076,
54.69506334794019,-8.643079599030155,
53.92008075859826,-7.570442064959563,
53.82332325264593,-7.000982725744818,
53.77410745429329,-5.915939888827071,
53.47005259608668,-5.829052031307595,
53.24936200974907,-5.808537631799653,
52.9591630548895,-5.838944245460175,
52.29598654024321,-5.836574564057029,
51.10471607342441,-8.426938140731721,
50.33177126991774,-8.43533546589374,
49.62745698268603,-8.402514673237834,
48.62100385916242,-8.155894266272702,
48.87541956994311,-7.048650130144581,
49.04283970161276,-6.038434696026258,
49.29576037792653,-5.241713914361389,
49.30832621017596,-4.142078371412637,
48.99240438916019,-3.610360370654134,
};

int pointinpoly(float *poly, int points, float x, float y)
{
        float *p = poly;
        float *l = &poly[points * 2 - 2];
        int c = 0;
 
        for(; points; points--, l = p, p += 2)
        {
                if(y < p[1] && y < l[1]) continue;
                if(y >= p[1] && y >= l[1]) continue;
                if(x < p[0] + (l[0] - p[0]) * (y - p[1]) / (l[1] - p[1])) continue;
 
                c = !c;
        }
 
        return(c);
}

int main(void)
	{
		if(pointinpoly(geofence, 50, 48.624558, -8.152936))
		
		//if(pointinpoly(geofence, 28, 65.1255, -5.3669))
		{
		printf("Geofence Active APRS Disabled\n");
		}
		
		else 

		{
		printf("Outside Geofence Turning On APRS\n");
		}
	}
